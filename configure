#!/bin/sh

prefix=/usr/local
valac=

while [ "$1" ]; do
	case $1 in
		--prefix=*)
			prefix=`expr "X$1" : '[^=]*=\(.*\)'` ;;
		--with-valac=*)
			valac=`expr "X$1" : '[^=]*=\(.*\)'` ;;
	esac
	shift
done

echo -n "Checking for Vala 0.1.6 or greater... "

pkg-config --atleast-version 0.1.6 vala-1.0

if [ $? -eq 0 ]; then
	echo "ok"
else
	version=`pkg-config --modversion vala-1.0`
	echo "no, found $version"
	exit 1
fi

echo -n "Checking for valac... "

if [ -z $valac ]; then
	valac=`which valac 2>/dev/null`

	if [ $? -eq 0 ]; then
		echo $valac
	else
		echo "vala compiler not found!"
		exit 1
	fi
elif [ -x $valac ]; then
	echo $valac
else
	echo "vala compiler not found!"
	exit 1
fi

echo -n "Generating config.mk... "

cat <<EOF > config.mk
PREFIX = $prefix
VALAC = $valac
EOF

echo "ok"
echo
echo "Now run 'make' to build Abraca."
